services:
  # Backend Service
  - type: web
    name: geld-backend
    env: node
    plan: starter
    buildCommand: cd server && npm install && npx prisma generate && npm run build
    startCommand: cd server && npx prisma migrate deploy && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: geld-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: FRONTEND_URL
        value: https://geld-frontend.up.railway.app
      - key: TMDB_API_KEY
        value: eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJmNDM3MzI3Y2Y5ZDI0YmNmMWJhODNlNTA1ZjhlMGEwNyIsIm5iZiI6MTc2OTYyMjYzNy4xOTUwMDAyLCJzdWIiOiI2OTdhNGM2ZDExM2YwNDkzYzExMmY2Y2EiLCJzY29wZXMiOlsiYXBpX3JlYWQiXSwidmVyc2lvbiI6MX0.cGdshBSCvpMofvGRBL3-GsEctxy2Gx_Ju6ds0BE5Mqo
      - key: GEMINI_API_KEY
        value: AIzaSyC760TcZEwEMgew4BwVwXpUR8lHDVabku8
      - key: LASTFM_API_KEY
        value: 1fde97017f141e52fc703f83f29b5138
      - key: GOOGLE_PLACES_API_KEY
        value: AIzaSyDsmiyvotuJbEHVbjjELwQrJdexMd91zAc
      - key: FOURSQUARE_API_KEY
        value: fsq3YckbXHBJjWaPM0vuXzPZp8yyYJhKXdcDaLUvC6ALnns=

  # Frontend Service
  - type: web
    name: geld-frontend
    env: static
    plan: starter
    buildCommand: cd client && npm install && npm run build
    staticPublishPath: ./client/dist
    envVars:
      - key: VITE_API_URL
        value: https://geld-backend.up.railway.app/api

databases:
  - name: geld-db
    plan: starter